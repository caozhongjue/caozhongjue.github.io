<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="spring boot,">










<meta name="description" content="目录结构 1.pom.xml 文件 &amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt; &amp;lt;project xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-inst">
<meta name="keywords" content="spring boot">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot实战">
<meta property="og:url" content="http://yoursite.com/2019/08/03/springboot实战/index.html">
<meta property="og:site_name" content="czj&#39;blog">
<meta property="og:description" content="目录结构 1.pom.xml 文件 &amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt; &amp;lt;project xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-inst">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/eBG4Xt.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/eBYJG4.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/eBtO9e.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/eBNCAf.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/eBthc9.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/eBtqhD.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/eBUDoV.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/erzl7T.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/erz8NF.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/erzt39.png">
<meta property="og:image" content="https://s2.ax1x.com/2019/08/03/erzOuq.png">
<meta property="og:updated_time" content="2019-08-11T03:42:37.222Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="springboot实战">
<meta name="twitter:description" content="目录结构 1.pom.xml 文件 &amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt; &amp;lt;project xmlns=&amp;quot;http://maven.apache.org/POM/4.0.0&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-inst">
<meta name="twitter:image" content="https://s2.ax1x.com/2019/08/03/eBG4Xt.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/08/03/springboot实战/">





  <title>springboot实战 | czj'blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">czj'blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/03/springboot实战/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="czj">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/05/23/VPZiAe.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="czj'blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">springboot实战</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-03T21:15:33+08:00">
                2019-08-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-boot/" itemprop="url" rel="index">
                    <span itemprop="name">spring boot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h6 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h6><p><img src="https://s2.ax1x.com/2019/08/03/eBG4Xt.png" alt="eBG4Xt.png"></p>
<p>1.pom.xml 文件</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.6.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;top.caozhongjue&lt;/groupId&gt;
    &lt;artifactId&gt;myblog&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;myblog&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!--springboot web--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!--引入thymeleaf模板引擎--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre><p>application.yml文件</p>
<pre><code>#整合thymeleaf
spring:
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    cache: false
    encoding: UTF-8
    mode: HTML    
</code></pre><p>index.java文件</p>
<pre><code>package top.caozhongjue.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class Index {
    @RequestMapping(&quot;/&quot;)
    public String index(@RequestParam(name = &quot;name&quot; )String name , Model model) {
        model.addAttribute(&quot;name&quot;,name);
        return &quot;index&quot;;
    }

}
</code></pre><p>index.html文件</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;springboot-thymeleaf demo&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
helloworld,您好啊，好坑啊你 asdfdasdf&lt;p th:text=&quot;&apos;hello&apos;+${name}+&apos;!&apos;&quot;&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src="https://s2.ax1x.com/2019/08/03/eBYJG4.png" alt="eBYJG4.png"><br>刚开始学各种奇葩问题<br>问题1 编译器乱码导致<br>Failed to load property source from location ‘classpath:/application.yml’<br>问题2 加web依赖<br>No active profile set, falling back to default profiles: default<br>问题3<br>找不到或无法加载主类 com.caozhongjue.myblog.MyblogApplication<br>问题4  thymeleaf要想用HTML5模板要指定版本<br>Template Mode ‘HTML5’ is deprecated. Using Template Mode ‘HTML’ instead.<br>问题5  内存溢出<br>D:\java\jdk\bin\java.exe<br>java.lang.OutOfMemoryError<br> at java.util.zip.ZipFile.open(Native Method)<br>问题6  找不到模板<br>org.thymeleaf.exceptions.TemplateInputException: Error resolving template [index], template might not exist or might not be accessible by any of the configured Template Resolvers\</p>
<p>提交代码到github<br>前提得下载安装git软件</p>
<pre><code>git init
git add
git commit
git remote add origin https://github.com/caozhongjue/myblog.git
git push -u origin master
</code></pre><p>在idea上加入git软件<br>idea上传代码（github上面没有这个仓库，会自动创建）<br><img src="https://s2.ax1x.com/2019/08/03/eBtO9e.png" alt="eBtO9e.png"><br><img src="https://s2.ax1x.com/2019/08/03/eBNCAf.png" alt="eBNCAf.png"><br>idea下载代码</p>
<p>idea上传修改过的代码<br><img src="https://s2.ax1x.com/2019/08/03/eBthc9.png" alt="eBthc9.png"><br>先点1更新代码，再点2提交代码，push到远程<br><img src="https://s2.ax1x.com/2019/08/03/eBtqhD.png" alt="eBtqhD.png"></p>
<p><img src="https://s2.ax1x.com/2019/08/03/eBUDoV.png" alt="eBUDoV.png"></p>
<p>idea快捷键</p>
<pre><code>ctrl+shift+n 快速查找某个文件
alt+insert 快速生成set get方法
alt+enter 快速导入包
ctrl+D 快速复制一行
ctrl+X 复制一行
</code></pre><h6 id="实现github授权登录功能"><a href="#实现github授权登录功能" class="headerlink" title="实现github授权登录功能"></a>实现github授权登录功能</h6><p>创建一个github应用程序<br><img src="https://s2.ax1x.com/2019/08/03/erzl7T.png" alt="erzl7T.png"></p>
<p><img src="https://s2.ax1x.com/2019/08/03/erz8NF.png" alt="erz8NF.png"></p>
<p><img src="https://s2.ax1x.com/2019/08/03/erzt39.png" alt="erzt39.png"></p>
<p><img src="https://s2.ax1x.com/2019/08/03/erzOuq.png" alt="erzOuq.png"></p>
<p><a href="https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/" target="_blank" rel="noopener">操作文档说明</a></p>
<p>引入依赖</p>
<pre><code>&lt;!-- okhttp 依赖--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;
    &lt;artifactId&gt;okhttp&lt;/artifactId&gt;
    &lt;version&gt;4.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- fastjson 依赖 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
    &lt;version&gt;1.2.56&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>前端请求地址</p>
<pre><code>https://github.com/login/oauth/authorize?client_id=Iv1.e73e751aed387889&amp;state=1&amp;redirect_uri=http://localhost:8080/callback&amp;scope=user    
</code></pre><p>AuthorizenController类</p>
<pre><code>package top.caozhongjue.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import top.caozhongjue.pojo.Access_token;
import top.caozhongjue.pojo.GithubUser;
import top.caozhongjue.provider.GitHubProvider;

import javax.servlet.http.HttpServletRequest;

@Controller
public class AuthorizenController {
    @Autowired
    private GitHubProvider gitHubProvider;
    @Value(&quot;${github.client.id}&quot;)
    private String clientid;
    @Value(&quot;${github.client.secret}&quot;)
    private String clientsecret;
    @Value(&quot;${github.redirect.uri}&quot;)
    private String redirecturi;

    @RequestMapping(&quot;/callback&quot;)
    public String callback(@RequestParam(name = &quot;code&quot;) String code,
                           @RequestParam(name=&quot;state&quot;)String state,
                           HttpServletRequest request){
        Access_token access_token = new Access_token();//封装一个token实体类，存值
        access_token.setCode(code);
        access_token.setState(state);
        access_token.setRedirect_uri(redirecturi);
        access_token.setClient_id(clientid);
        access_token.setClient_secret(clientsecret);
        String stoken = gitHubProvider.getAccess_token(access_token);//获取stoken方法，返回stoken
        GithubUser githubUser = gitHubProvider.getGithubUser(stoken);//获取user信息方法，返回GithubUser
        //System.out.println(githubUser.getLogin()+&quot;====&quot;+githubUser.getId());
        if(githubUser != null){
            request.getSession().setAttribute(&quot;user&quot;,githubUser);
            return &quot;redirect:/&quot;; //redirect重定向到哪个路径
        }else{
            return &quot;redirect:/&quot;;
        }
    }
}
</code></pre><p>GitHubProvider类</p>
<pre><code>package top.caozhongjue.provider;

import com.alibaba.fastjson.JSON;
import okhttp3.*;
import org.springframework.stereotype.Component;
import top.caozhongjue.pojo.Access_token;
import top.caozhongjue.pojo.GithubUser;
import java.io.IOException;

@Component
public class GitHubProvider {
    //通过回调url携带code，获取token
    public String getAccess_token(Access_token access_token){
        final MediaType json = MediaType.get(&quot;application/json; charset=utf-8&quot;);
        OkHttpClient client = new OkHttpClient();

        RequestBody body = RequestBody.create(json, JSON.toJSONString(access_token));
        Request request = new Request.Builder()
                .url(&quot;https://github.com/login/oauth/access_token&quot;)
                .post(body)
                .build();
        try (Response response = client.newCall(request).execute()) {
            String string = response.body().string();
            String[] split =string.split(&quot;&amp;&quot;);
            String stoken = split[0];
            String[] splitstoken =stoken.split(&quot;=&quot;);
            String token = splitstoken[1];
            //System.out.println(token);
            return token;
        }catch (IOException e){
            e.printStackTrace();
        }
        return null;
    }
    //携带token，获取用户信息
    public GithubUser getGithubUser(String accesstoken){
        OkHttpClient client = new OkHttpClient();
        Request request = new Request.Builder()
                .url(&quot;https://api.github.com/user?access_token=&quot;+accesstoken)
                .build();
        try (Response response = client.newCall(request).execute()) {
            String string = response.body().string();
            GithubUser githubUser = JSON.parseObject(string,GithubUser.class);
            return githubUser;
        }catch (IOException e){
        }
        return  null;
    }

}
</code></pre><p>GithubUser类</p>
<pre><code>package top.caozhongjue.pojo;

public class GithubUser {
    private String login;
    private Long id;
    private String bio;

    public String getLogin() {
        return login;
    }

    public void setLogin(String login) {
        this.login = login;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getBio() {
        return bio;
    }

    public void setBio(String bio) {
        this.bio = bio;
    }
}
</code></pre><p>Access_token类</p>
<pre><code>package top.caozhongjue.pojo;

public class Access_token {
    private String client_id;
    private String client_secret;
    private String code;
    private String redirect_uri;
    private String state;

    public String getClient_id() {
        return client_id;
    }

    public void setClient_id(String client_id) {
        this.client_id = client_id;
    }

    public String getClient_secret() {
        return client_secret;
    }

    public void setClient_secret(String client_secret) {
        this.client_secret = client_secret;
    }

    public String getCode() {
        return code;
    }

    public void setCode(String code) {
        this.code = code;
    }

    public String getRedirect_uri() {
        return redirect_uri;
    }

    public void setRedirect_uri(String redirect_uri) {
        this.redirect_uri = redirect_uri;
    }

    public String getState() {
        return state;
    }

    public void setState(String state) {
        this.state = state;
    }
}
</code></pre><p>application.yml文件<br>自定义属性值  @Value(“${}”)取值</p>
<pre><code>github:
  client:
    id: Iv1.e73e751aed387889
    secret: a047b90c7d5b6de3bbd035c4af962482bae0177c
  redirect:
    uri: http://localhost:8080/callback
</code></pre><h6 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a>发布文章</h6><p>PublishIndex类</p>
<pre><code>package top.caozhongjue.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import top.caozhongjue.dao.QuestionMapper;
import top.caozhongjue.dao.UserMapper;
import top.caozhongjue.pojo.Question;
import top.caozhongjue.pojo.User;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;

/**
 * 发布文章控制器
 */
@Controller
public class PublishController {
    @Autowired
    private QuestionMapper questionMapper;
    @Autowired
    private UserMapper userMapper;
    @RequestMapping(&quot;/publish&quot;)
    public String publish(){
        return &quot;publish&quot;;
    }
    @PostMapping(&quot;/dopublish&quot;)
    public String doPublish(
            @RequestParam(&quot;title&quot;)String title,
            @RequestParam(&quot;description&quot;)String description,
            @RequestParam(&quot;tags&quot;)String tags,
            HttpServletRequest request,
            Model model){
        Question question = new Question();
        User user = null;
        Cookie[] cookies = request.getCookies();
        if(cookies !=null){
            for (Cookie cookie : cookies){
                if(cookie.getName().equals(&quot;token&quot;)){
                    String token = cookie.getValue();
                    user = userMapper.findByToken(token);
                    if(user != null){
                        request.getSession().setAttribute(&quot;user&quot;,user);
                    }
                    break;
                }
            }
        }
        if(user== null){
           model.addAttribute(&quot;error&quot;,&quot;发表文章，请登录&quot;);
           return &quot;publish&quot;;
        }
        question.setTitle(title);
        question.setDescription(description);
        question.setTags(tags);
        question.setCreator(user.getId());
        question.setGmtCreate(System.currentTimeMillis());
        question.setGmtModified(question.getGmtCreate());
        questionMapper.create(question);
        return &quot;redirect:/&quot;;
    }

}
</code></pre><p>QuestionMapper接口</p>
<pre><code>package top.caozhongjue.dao;

import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;
import top.caozhongjue.pojo.Question;

import java.util.List;

@Mapper
public interface QuestionMapper {
    @Insert(&quot;insert into question (title,description,gmt_create,gmt_modified,creator,comment_count,view_count,like_count,tags) &quot; +
            &quot;values(#{title},#{description},#{gmtCreate},#{gmtModified},#{creator},#{commentCount},#{viewCount},#{likeCount},#{tags})&quot;)
    public void create(Question question);
    @Select(&quot;select * from user where token = #{token}&quot;)
    User findByToken(@Param(&quot;token&quot;) String token);
}
</code></pre><p>publish页面</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;czj&apos;blog&lt;/title&gt;
&lt;/head&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.4.1.js&quot;&gt;&lt;/script&gt;
&lt;!--&lt;script type=&quot;text/javascript&quot; src=&quot;js/bootstrap.min.js&quot;&gt;&lt;/script&gt;--&gt;
&lt;!--&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;css/bootstrap.min.css&quot;&gt;--&gt;
&lt;!--&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;css/bootstrap-theme.min.css&quot;&gt;--&gt;
&lt;!--最新版本的 Bootstrap 核心 CSS 文件 --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;
      integrity=&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot; crossorigin=&quot;anonymous&quot;&gt;
&lt;!--可选的 Bootstrap 主题文件（一般不用引入） --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css&quot;
      integrity=&quot;sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp&quot; crossorigin=&quot;anonymous&quot;&gt;
&lt;!--最新的 Bootstrap 核心 JavaScript 文件 --&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js&quot;
        integrity=&quot;sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa&quot;
        crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;


&lt;body style=&quot;background-color: #efefef&quot;&gt;
&lt;div style=&quot;width: 1000px;margin: auto;&quot;&gt;
    &lt;nav class=&quot;navbar navbar-default&quot;&gt;
        &lt;div class=&quot;container-fluid&quot;&gt;
            &lt;!-- Brand and toggle get grouped for better mobile display --&gt;
            &lt;div class=&quot;navbar-header&quot;&gt;
                &lt;button type=&quot;button&quot; class=&quot;navbar-toggle collapsed&quot; data-toggle=&quot;collapse&quot;
                        data-target=&quot;#bs-example-navbar-collapse-1&quot; aria-expanded=&quot;false&quot;&gt;
                    &lt;span class=&quot;sr-only&quot;&gt;Toggle navigation&lt;/span&gt;
                    &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;
                    &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;
                    &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;
                &lt;/button&gt;
                &lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;czj 论坛&lt;/a&gt;
            &lt;/div&gt;
            &lt;!-- Collect the nav links, forms, and other content for toggling --&gt;
            &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;bs-example-navbar-collapse-1&quot;&gt;
                &lt;form class=&quot;navbar-form navbar-left&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;搜索...&quot;&gt;
                    &lt;/div&gt;
                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;搜索&lt;/button&gt;
                &lt;/form&gt;
                &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;
                    &lt;li th:if=&quot;${session.user != null}&quot;&gt;
                        &lt;a href=&quot;/publish&quot; &gt;发布&lt;/a&gt;
                    &lt;/li&gt;
                    &lt;li class=&quot;dropdown&quot; th:if=&quot;${session.user != null}&quot;&gt;
                        &lt;a href=&quot;#&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot; role=&quot;button&quot; aria-haspopup=&quot;true&quot;
                           aria-expanded=&quot;false&quot; th:text=&quot;${session.user.getName()}&quot;&gt;&lt;span class=&quot;caret&quot;&gt;&lt;/span&gt;&lt;/a&gt;
                        &lt;ul class=&quot;dropdown-menu&quot;&gt;
                            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;消息中心&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;个人中心&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;退出登录&lt;/a&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/li&gt;
                    &lt;li th:if=&quot;${session.user==null}&quot;&gt;
                        &lt;a href=&quot;https://github.com/login/oauth/authorize?client_id=Iv1.e73e751aed387889&amp;state=1&amp;redirect_uri=http://localhost:8080/callback&amp;scope=user&quot;&gt;登录&lt;/a&gt;
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;&lt;!-- /.navbar-collapse --&gt;
        &lt;/div&gt;&lt;!-- /.container-fluid --&gt;
    &lt;/nav&gt;
    &lt;div class=&quot;container-fluid&quot; style=&quot;background-color: white&quot;&gt;
        &lt;div class=&quot;row&quot; style=&quot;height: 100%;&quot;&gt;
            &lt;div class=&quot;col-lg-9 col-md-12 col-sm-12 col-xs-12&quot;&gt;
                &lt;h2&gt;&lt;span class=&quot;glyphicon glyphicon-plus&quot;&gt;&lt;/span&gt;发表提问&lt;/h2&gt;
                &lt;hr&gt;
                &lt;form action=&quot;/dopublish&quot; method=&quot;post&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;title&quot;&gt;问题标题(概要简述):&lt;/label&gt;
                        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;title&quot; id=&quot;title&quot; placeholder=&quot;标题&quot;&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;title&quot;&gt;问题内容(详细问题内容):&lt;/label&gt;
                        &lt;textarea name=&quot;description&quot; id=&quot;description&quot; class=&quot;form-control&quot; cols=&quot;30&quot; rows=&quot;10&quot;
                                  placeholder=&quot;内容&quot;&gt;
                                &lt;/textarea&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;title&quot;&gt;添加标签:&lt;/label&gt;
                        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;tags&quot; name=&quot;tags&quot; placeholder=&quot;添加标签以,隔开&quot;&gt;
                    &lt;/div&gt;
                    &lt;span class=&quot;alert alert-danger&quot; th:if=&quot;${error != null}&quot; th:text=&quot;${error}&quot; role=&quot;alert&quot;&gt;&lt;/span&gt;
                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot; style=&quot;float: right; margin-bottom: 15px&quot;&gt;发布&lt;/button&gt;
                &lt;/form&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-lg-3 col-md-12 col-sm-12 col-xs-12&quot;&gt;
                &lt;h3&gt;问题发起指南&lt;/h3&gt;
                问题标题:请用精简的语言描述您发布的问题,不超过25字,问题补充:详细补充您的问题内容,并确保问题描述清析直观.ok
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h6 id="首页发布的文章显示"><a href="#首页发布的文章显示" class="headerlink" title="首页发布的文章显示"></a>首页发布的文章显示</h6><p>IndexController类</p>
<pre><code>package top.caozhongjue.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import top.caozhongjue.dao.QuestionMapper;
import top.caozhongjue.dao.UserMapper;
import top.caozhongjue.dto.PaginationDTO;
import top.caozhongjue.dto.QuestionDTO;
import top.caozhongjue.pojo.Question;
import top.caozhongjue.pojo.User;
import top.caozhongjue.services.QuestionService;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import java.util.List;

/**
 * 首页访问路径控制器
 */
@Controller
public class IndexController {
    @Autowired
    private UserMapper userMapper;

    @Autowired
    private QuestionMapper questionMapper;
    @Autowired
    private QuestionService questionService;

    @RequestMapping(&quot;/&quot;)
    public String index(HttpServletRequest request,
                        Model model,@RequestParam(value = &quot;page&quot;,defaultValue = &quot;1&quot;)Integer page,
                        @RequestParam(value = &quot;size&quot;,defaultValue = &quot;2&quot;)Integer size) {
        Cookie[] cookies = request.getCookies();
        if(cookies!=null){
            for(Cookie cookie :cookies){
                if(cookie.getName().equals(&quot;token&quot;)){
                    String token = cookie.getValue();
                    User user = userMapper.findByToken(token);
                    if(user!=null){
                        request.getSession().setAttribute(&quot;user&quot;,user);
                    }
                    break;
                }
            }
        }
//      List&lt;QuestionDTO&gt; listQuestions = questionService.listQuestionDTO(page,size);
        PaginationDTO paginationDTO = questionService.listQuestionDTO(page,size);
        model.addAttribute(&quot;paginationDTO&quot;,paginationDTO);
        return &quot;index&quot;;
    }
}
</code></pre><p>QuestionServices类</p>
<pre><code>package top.caozhongjue.services;

import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import top.caozhongjue.dao.QuestionMapper;
import top.caozhongjue.dao.UserMapper;
import top.caozhongjue.dto.PaginationDTO;
import top.caozhongjue.dto.QuestionDTO;
import top.caozhongjue.pojo.Question;
import top.caozhongjue.pojo.User;

import java.util.ArrayList;
import java.util.List;

@Service
public class QuestionService {
    @Autowired
    private QuestionMapper questionMapper;
    @Autowired
    private UserMapper userMapper;


    public PaginationDTO listQuestionDTO(Integer page, Integer size) {
        List&lt;QuestionDTO&gt; questionDTOList = new ArrayList&lt;&gt;();
        PaginationDTO paginationDTOS = new PaginationDTO();
        Integer totalCount = questionMapper.count();
        paginationDTOS.setPagination(totalCount,page,size);
        //防止超过页数据还显示
        if (page&lt;1){
            page=1;
        }
        if(page&gt;paginationDTOS.getTotalPages()){
            page=paginationDTOS.getTotalPages();
        }
        // mysql 分页 limit 0,5 从第0条数据开始，查出5条,第一页0-5 ，第二页5-10 ,第三页10-15
        Integer offset = (page-1)*size;
        List&lt;Question&gt; questions = questionMapper.listQuestin(offset,size);
        for(Question question:questions){
            User user = userMapper.findById(question.getCreator());
            QuestionDTO questionDTO = new QuestionDTO();
            BeanUtils.copyProperties(question,questionDTO);
            questionDTO.setUser(user);
            questionDTOList.add(questionDTO);
        }
        paginationDTOS.setQuestions(questionDTOList);

        //return questionDTOList;
        return paginationDTOS;
    }
}
</code></pre><p>QuestinDTO类</p>
<pre><code>package top.caozhongjue.dto;

import lombok.Data;
import top.caozhongjue.pojo.User;

@Data
public class QuestionDTO {
    private Integer id;
    private String title;
    private String description;
    private String tags;
    private Long gmtCreate;
    private Long gmtModified;
    private Integer creator;
    private Integer viewCount;
    private Integer commentCount;
    private Integer likeCount;
    private User user;
}
</code></pre><p>PaginationDTO类</p>
<pre><code>package top.caozhongjue.dto;

import lombok.Data;

import java.util.ArrayList;
import java.util.List;
@Data
public class PaginationDTO {
    private List&lt;QuestionDTO&gt; questions;//存放数据
    private boolean hasPrevious;//上一页
    private boolean hasNexts;//下一页
    private boolean hasFirstPage;//第一页
    private boolean hasEndPage;//最后一页

    private Integer currentPage;//当前页
    private List&lt;Integer&gt; pages = new ArrayList&lt;&gt;();//
    private Integer totalPages;
    public void setPagination(Integer totalCount, Integer page, Integer size) {
        //查总共多少页
        if(totalCount % size ==0){
            totalPages = totalCount / size;
        }else{
            totalPages = totalCount / size +1;
        }
        //防止超过页数据还显示
        if (page&lt;1){
            page=1;
        }
        if(page&gt;totalPages){
            page=totalPages;
        }
        this.currentPage=page;
        pages.add(page);
        for(int i = 1; i &lt;= 3 ; i ++){
            if(page-i&gt;0){
                pages.add(0,page-i);
            }
            if(page+i&lt;=totalPages){
                pages.add(page+i);
            }
        }
        //是否展示上一页
        if(page == 1){
            hasPrevious =false;
        }else{
            hasPrevious = true;
        }
        //是否展示下一页
        if(page == totalPages){
            hasNexts = false;
        }else{
            hasNexts = true;
        }
        //是否展示第一页
        if(pages.contains(1)){
            hasFirstPage = false;
        }else{
            hasFirstPage = true;
        }
        //是否展示最后一页
        if(pages.contains(totalPages)){
            hasEndPage = false;
        }else{
            hasEndPage = true;
        }
    }
}
</code></pre><p>QuestionMapper接口</p>
<pre><code>package top.caozhongjue.dao;

import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;
import top.caozhongjue.pojo.Question;

import java.util.List;

@Mapper
public interface QuestionMapper {

    @Select(&quot;select * from question limit #{offset},#{size}&quot;)
    List&lt;Question&gt; listQuestin(@Param(&quot;offset&quot;) Integer offset, @Param(&quot;size&quot;) Integer size);
    @Select(&quot;select count(1) from question&quot;)
    Integer count();
}
</code></pre><p>UserMapper接口</p>
<pre><code>package top.caozhongjue.dao;
import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;
import top.caozhongjue.pojo.User;

@Mapper
public interface UserMapper {

    @Select(&quot;select * from user where id = #{id}&quot;)
    User findById(@Param(&quot;id&quot;) Integer id);

}
</code></pre><p>页面html</p>
<pre><code>&lt;div class=&quot;container-fluid&quot; style=&quot;background-color: white&quot; &gt;
                &lt;div class=&quot;row&quot; style=&quot;height: 100%;&quot;&gt;
                    &lt;div class=&quot;col-lg-9 col-md-12 col-sm-12 col-xs-12&quot;&gt;
                        &lt;span class=&quot;glyphicon glyphicon-list&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;
                        &lt;hr style=&quot;margin-bottom: 15px;margin-top: 15px&quot;&gt;
                        &lt;div class=&quot;media&quot; th:each=&quot;listQuestion:${paginationDTO.questions}&quot;&gt;
                            &lt;div class=&quot;media-left&quot;&gt;
                                &lt;a href=&quot;#&quot;&gt;
                                    &lt;img class=&quot;media-object img-rounded&quot; th:src=&quot;${listQuestion.user.avatarUrl}&quot; style=&quot;width: 45px&quot;/&gt;
                                &lt;/a&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;media-body&quot;&gt;
                                &lt;h4 class=&quot;media-heading&quot; th:text=&quot;${listQuestion.title}&quot;&gt;&lt;/h4&gt;
                                &lt;span th:text=&quot;${listQuestion.description}&quot;&gt;&lt;/span&gt;&lt;br&gt;
                                &lt;span class=&quot;text_des&quot; &gt;
                                    &lt;span th:text=&quot;${listQuestion.commentCount}&quot;&gt;&lt;/span&gt; 个回复 • &lt;span th:text=&quot;${listQuestion.viewCount}&quot;&gt;&lt;/span&gt; 次浏览 • &lt;span th:text=&quot;${#dates.format(listQuestion.gmtCreate,&apos;yyyy-dd-MM HH:MM&apos;)}&quot;&gt;&lt;/span&gt;  &lt;/span&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;nav aria-label=&quot;Page navigation&quot;&gt;
                            &lt;ul class=&quot;pagination&quot;&gt;
                                &lt;!--第一页--&gt;
                                &lt;li th:if=&quot;${paginationDTO.hasFirstPage}&quot;&gt;
                                    &lt;a href=&quot;/?page=1&quot; aria-label=&quot;Previous&quot; &gt;
                                        &lt;span aria-hidden=&quot;true&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;
                                    &lt;/a&gt;
                                &lt;/li&gt;
                                &lt;!--上一页--&gt;
                                &lt;li th:if=&quot;${paginationDTO.hasPrevious}&quot;&gt;
                                    &lt;a th:href=&quot;@{/(page=${(paginationDTO.currentPage)-1})}&quot; aria-label=&quot;Previous&quot;&gt;
                                        &lt;span aria-hidden=&quot;true&quot;&gt;&amp;lt;&lt;/span&gt;
                                    &lt;/a&gt;
                                &lt;/li&gt;
                                &lt;li th:each=&quot;page : ${paginationDTO.pages}&quot;  th:class=&quot;${paginationDTO.currentPage==page}?&apos;active&apos;:&apos;&apos; &quot; &gt;
                                    &lt;a th:href=&quot;@{/(page=${page})}&quot; th:text=&quot;${page}&quot;&gt;&lt;/a&gt;
                                &lt;/li&gt;
                                &lt;!--下一页--&gt;
                                &lt;li th:if=&quot;${paginationDTO.hasNexts}&quot;&gt;
                                    &lt;a th:href=&quot;@{/(page=${(paginationDTO.currentPage)+1})}&quot; aria-label=&quot;Next&quot;&gt;
                                        &lt;span aria-hidden=&quot;true&quot;&gt;&amp;gt;&lt;/span&gt;
                                    &lt;/a&gt;
                                &lt;/li&gt;
                                &lt;!--最后一页--&gt;
                                &lt;li th:if=&quot;${paginationDTO.hasEndPage}&quot;&gt;
                                    &lt;a th:href=&quot;@{/(page=${paginationDTO.totalPages})}&quot; aria-label=&quot;Next&quot;&gt;
                                        &lt;span aria-hidden=&quot;true&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;
                                    &lt;/a&gt;
                                &lt;/li&gt;
                            &lt;/ul&gt;
                        &lt;/nav&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;col-lg-3 col-md-12 col-sm-12 col-xs-12&quot; &gt;
                        热门话题
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
</code></pre>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/spring-boot/" rel="tag"># spring boot</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/20/php/" rel="next" title="php入门">
                <i class="fa fa-chevron-left"></i> php入门
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/17/微信小程序/" rel="prev" title="微信小程序">
                微信小程序 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://s2.ax1x.com/2019/05/23/VPZiAe.png" alt="czj">
            
              <p class="site-author-name" itemprop="name">czj</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-6"><a class="nav-link" href="#目录结构"><span class="nav-number">1.</span> <span class="nav-text">目录结构</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#实现github授权登录功能"><span class="nav-number">2.</span> <span class="nav-text">实现github授权登录功能</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#发布文章"><span class="nav-number">3.</span> <span class="nav-text">发布文章</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#首页发布的文章显示"><span class="nav-number">4.</span> <span class="nav-text">首页发布的文章显示</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">czj</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
